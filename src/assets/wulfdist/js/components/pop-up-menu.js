/*!
 * WULF v1.2.39 (http://wulf-demo.dynamic.nsn-net.net/)
 * Copyright Â© 2016-2017 Nokia. All rights Reserved.
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./keyboard/keyboard-popupmenu"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c,require("./keyboard/keyboard-table")),c}:a(jQuery)}(function(a){"use strict";a(document).ready(function(){document.oncontextmenu=function(b){a(b.target).closest(".n-popupmenu-context").length&&b.preventDefault()},a(document).on("mousedown.wf.popupmenu",function(b){var c=0;if(b.button===c){var d=a(".n-popup-menu");d.length&&(document.contains?d[0].contains(b.target)||d.css("display","none"):16!==d[0].compareDocumentPosition(b.target)&&d.css("display","none"))}})});var b=function(b,c){var d=this;this.$element=a(b),a(document.body).append('<div id="'+c.containerid+'" class="n-popupmenu-context"></div>'),this.$container=a("#"+c.containerid),this.$container.css("position","absolute"),this.data=c.data,this.options=c,this.zindex=1e4,this.showIcon=c.showIcon,this.loopData=function(b,c){var d=this,e='<ul class="n-popup-menu" ul-rank="1" role="menu">';return c&&(e='<ul class="n-popup-sub-menu">'),b&&"object"==typeof b&&(a.each(b,function(a,b){var c=b.disable?"disabled=disabled":"",f="<li>";b.children&&b.children.length>0&&(f='<li class="n-popup-menu-item-has-child">'),f+='<a href="javascript:void(0)"'+c+">",d.showIcon&&(f+='<span class="n-popupmenu-icon '+b.iconClass+'"></span>'),f+="<span>"+b.label+"</span>",b.children&&b.children.length>0&&(f+='<i class="icon icon-next" '+c+"></i></a>"),f+="</li>",e+=f}),e+="</ul>"),e};var e=function(a){var b=a.data,c=d.loopData(b);d.$container.append(c)},f=function(){d.$container.on("mouseover touchstart",".n-popup-menu-item-has-child>a",a.proxy(d.showSubMenu,d)),d.$container.on("mousedown","li a",a.proxy(d.handleMenuSelection,d)),d.$container.on("mouseleave",".n-popup-menu-item-has-child",a.proxy(d.showSubMenu,d)),d.$element.mousedown(a.proxy(d.onRightClick,d)),d.$element.on("keydown.wf.popupmenu",a.wfKBPopupmenu.handleKeydownOnElement),d.$container.on("keydown.wf.popupmenu",a.wfKBPopupmenu.handleKeydownOnContainer)},g=function(){e(c),d.$container.find("ul.n-popup-menu").css({display:"none"}),f()};g.call(this)};b.prototype={constructor:b,generateSubMenu:function(b){for(var c=this.data,d=a(b.target).closest("li"),e=[d.index()],f=d.closest("ul"),g=0,h=4,i=1;h>i;i++){if(f.length){if("n-popup-menu"===f.attr("class")){g=i;break}e.push(f.parent().index())}f=f.parent().closest("ul")}for(var j=null,k=e.length-1;k>=0;k--)j=k===e.length-1?c[e[k]]:j.children[e[k]];d.append(this.loopData(j.children,!0)),this.zindex++,d.children().last().css("z-index",this.zindex),d.closest("ul").attr("ul-rank",g)},showSubMenu:function(b){b.stopPropagation();var c=a(b.target).closest("li"),d=c.find(">ul.n-popup-sub-menu");return"mouseleave"===b.type?(c.removeClass("selected"),d.length&&d.css("display","none")):"disabled"!==c.attr("disabled")&&(c.addClass("selected").siblings().removeClass("selected"),c.parent().find(".n-popup-sub-menu").css("display","none"),d.length?d.css("display","block"):this.generateSubMenu(b),this.setPosition(c)),!1},setPosition:function(a){var b=this.$container.find(".n-popup-menu"),c=parseInt(b.attr("clientx")),d=parseInt(b.attr("clienty")),e=b.outerWidth(),f=b.outerHeight(),g=a.children().last(),h=a.closest("ul"),i=b.attr("h-direction"),j=b.attr("v-direction"),k=document.documentElement.clientWidth,l=document.documentElement.clientHeight,m=g.width(),n=h.width();g.css("right","initial");var o="1",p="2";switch(h.attr("ul-rank")){case o:if("left"===i){g.css("left",-m),g.attr("h-direction","left");break}"up"===j&&(d-=f),c+b.width()+m<k?(g.css("left",g.parent().closest("ul").width()),g.attr("h-direction","right")):(g.css("left",-m),g.attr("h-direction","left")),d+a.height()*a.index()+g.height()<l?(g.css("bottom","initial"),g.css("top",-parseInt(b.css("margin-top"))-parseInt(b.css("padding-top")))):(g.css("top","initial"),g.css("bottom",-parseInt(b.css("margin-bottom"))-parseInt(b.css("padding-bottom"))));break;case p:"left"===i&&(c=k-e),"up"===j&&(d-=f),"right"===h.attr("h-direction")?k>=c+e+n+m?(g.css("left",a.width()),g.attr("h-direction","right")):(g.css("left",-g.width()),g.attr("h-direction","left")):k>=c+m?(g.css("left",a.width()),g.attr("h-direction","right")):(g.css("left",-g.width()),g.attr("h-direction","left")),d+h.parent().index()*b.find("li").height()+a.height()*a.index()+g.height()<l?(g.css("bottom","initial"),g.css("top",-parseInt(b.css("margin-top")+b.css("padding-top")))):(g.css("top","initial"),g.css("bottom",-parseInt(b.css("padding-bottom")+b.css("margin-bottom"))))}},onRightClick:function(b,c){var d=this.$container,e=this.$container.find("ul.n-popup-menu"),f=document.documentElement.clientHeight-document.body.clientHeight,g=2;if("mousedown"===b.type&&b.button===g||"keydown"===c){if("keydown"!==c)b.clientX+a(".n-popup-menu").outerWidth()<document.documentElement.clientWidth?(d.css("right","initial"),d.css("left",b.pageX),e.attr("h-direction","right")):(d.css("left","initial"),d.css("right",e.outerWidth()),e.attr("h-direction","left")),b.clientY+a(".n-popup-menu").outerHeight()<document.documentElement.clientHeight?(d.css("bottom","initial"),d.css("top",b.pageY-f),e.attr("v-direction","down")):(d.css("bottom","initial"),d.css("top",b.pageY-f-e.outerHeight()),e.attr("v-direction","up")),e.attr({clientx:b.clientX,clienty:b.clientY});else{var h=this.$element,i=h.offset(),j=h.width()/2+parseInt(h.css("margin-left"))+parseInt(h.css("padding-left")),k=h.height()/2+parseInt(h.css("margin-top"))+parseInt(h.css("padding-top"));i.left-document.body.scrollLeft+j+a(".n-popup-menu").outerWidth()<document.documentElement.clientWidth?(d.css("right","initial"),d.css("left",i.left+j),e.attr("h-direction","right")):(d.css("left","initial"),d.css("right",e.outerWidth()),e.attr("h-direction","left")),i.top-document.body.scrollTop+k+a(".n-popup-menu").outerHeight()<document.documentElement.clientHeight?(d.css("bottom","initial"),d.css("top",i.top+k-f),e.attr("v-direction","down")):(d.css("bottom","initial"),d.css("top",i.top+k-e.outerHeight()-f),e.attr("v-direction","up")),e.attr({clientx:i.left-document.body.scrollLeft+j,clienty:i.top-document.body.scrollTop+k})}return e.css("z-index",1e4),d.find("ul.n-popup-menu").css("display","block"),d.find(".n-popup-sub-menu").css("display","none"),e.find("li>a:first").focus(),b.stopPropagation(),!1}},handleMenuSelection:function(b,c){var d=0;if(b.stopPropagation(),"mousedown"===b.type&&b.button===d||"keydown"===c){var e=a(b.target).closest("li"),f="n-popup-menu-item-has-child"===e.attr("class");if(f||"disabled"===e.attr("disabled"))return e.find(">a").focus(),!1;f||(this.$container.find("li.selected").removeClass("selected"),a(".n-popup-menu").css("display","none")),this.options.handleMenuSelection&&"function"==typeof this.options.handleMenuSelection&&this.options.handleMenuSelection(e)}return!1}},a.fn.popupmenu=function(c){var d,e=Array.prototype.slice.call(arguments,1),f=this.each(function(){var f=a(this),g=f.data("wf.popupmenu"),h="object"==typeof c&&c;g||f.data("wf.popupmenu",g=new b(this,h)),"string"==typeof c&&(d=g[c].apply(g,e))});return void 0===d?f:d}});